{"version":3,"sources":["captcha.js"],"names":["System","register","_export","_context","GragwarCaptcha","RecaptchaCaptcha","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","setters","execute","el","options","_this","this","$image","$element","querySelector","$input","$refreshButton","$buttonIcon","addEventListener","protoProps","staticProps","value","_this2","classList","add","src","dataset","image","t","Date","getTime","toString","Math","random","indexOf","remove","once","prototype","u","directive","mounted","module","type","callbackName","callback","jsVerify","closest","form","e","passCaptcha","stopPropagation","stopImmediatePropagation","grecaptcha","preventDefault","response","alert","__","_ref"],"mappings":"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","file":"captcha.js","sourcesContent":["/**\n * Part of earth project.\n *\n * @copyright  Copyright (C) 2022 __ORGANIZATION__.\n * @license    __LICENSE__\n */\n\nclass GragwarCaptcha {\n  constructor(el, options) {\n    this.$element = el;\n    this.options = options;\n    this.$image = this.$element.querySelector('[data-captcha-image]');\n    this.$input = this.$element.querySelector('[data-captcha-input]');\n    this.$refreshButton = this.$element.querySelector('[data-captcha-refresh]');\n    this.$buttonIcon = this.$element.querySelector('[data-refresh-icon]');\n\n    this.$refreshButton.addEventListener('click', () => {\n      this.refresh();\n    });\n  }\n\n  refresh() {\n    this.$buttonIcon.classList.add('fa-spin');\n\n    let src = this.$image.dataset.image;\n    const t = (new Date).getTime().toString() + '.' + (Math.random() * 10000);\n\n    if (src.indexOf('?') !== -1) {\n      src += '&t=' + t;\n    } else {\n      src += '?t=' + t;\n    }\n\n    this.$image.addEventListener('load', () => {\n      this.$buttonIcon.classList.remove('fa-spin');\n      this.$input.value= '';\n    }, { once: true });\n\n    this.$image.src = src;\n  }\n\n  clear() {\n    this.$input.value = '';\n  }\n}\n\nu.directive('captcha-gregwar', {\n  mounted(el) {\n    u.module(el, 'captcha.grwgwar', (el) => new GragwarCaptcha(el));\n  }\n});\n\nclass RecaptchaCaptcha {\n  constructor(el, type) {\n    u.import('https://www.google.com/recaptcha/api.js?76129425953b553edf8c86cf');\n\n    this.el = el;\n    this.type = type;\n\n    this.key = this.el.dataset.key;\n    this.callbackName = this.el.dataset.callback;\n\n    this.jsVerify = this.el.dataset.jsVerify;\n\n    if (this.jsVerify) {\n      const form = this.el.closest('form');\n\n      if (type === 'invisible') {\n        form.addEventListener('submit', (e) => {\n          if (form.dataset.passCaptcha) {\n            return;\n          }\n\n          e.preventDefault();\n          e.stopPropagation();\n          e.stopImmediatePropagation();\n\n          grecaptcha.execute();\n        });\n\n        window[this.callbackName] = function(response) {\n          form.dataset.passCaptcha = 'true';\n          form.requestSubmit();\n        }\n      } else {\n        form.addEventListener('submit', (e) => {\n          if (form.dataset.passCaptcha) {\n            return;\n          }\n\n          e.preventDefault();\n          e.stopPropagation();\n          e.stopImmediatePropagation();\n\n          alert(u.__('luna.field.captcha.message.please.check.first'));\n        });\n\n        window[this.callbackName] = function(response) {\n          form.dataset.passCaptcha = 'true';\n        }\n      }\n    }\n  }\n}\n\nu.directive('captcha-recaptcha', {\n  mounted(el, { value }) {\n    u.module(el, 'captcha.recaptcha', (el) => new RecaptchaCaptcha(el, value));\n  }\n});\n"]}