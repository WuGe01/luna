"use strict";!function(){var e;$(function(){e=window.swal||function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;alert(e+" / "+t)}});var t="new",i="uploading",a="completed",n="fail",s={components:{"vue-drag-uploader-item":{template:'<div class="vue-drag-uploader__item preview-img"\n    :style="{ width: size ? size + \'px\' : null, height: size ? size + \'px\' : null }"\n    @click="$emit(\'click\', item, i, $event)">\n    <slot name="item" :item="item">\n        <div v-if="isImage" class="preview-img__body"\n            :style="{\'background-image\': \'url(\' + (item.thumb_url || item.url) + \')\'}"></div>\n\n        <div v-if="!isImage" class="preview-img__body d-flex justify-content-center align-items-center">\n            <div class="text-center">\n                <div>\n                    <span :class="icon" class="fa-3x"></span>\n                </div>\n                <div style="word-break: break-word">{{ fileName }}</div>\n            </div>\n        </div>\n\n        <div class="preview-img__overlay">\n          <span class="preview-img__remove-icon fa fa-times"\n              @click.stop.prevent="deleteSelf()"></span>\n            <slot name="extra" :item="item"></slot>\n        </div>\n\n        <div class="preview-img__progress" v-if="state === \'uploading\'">\n            <div class="preview-img__progress-bar"\n                :style="{width: (progress * 100) + \'%\'}"\n            ></div>\n        </div>\n        <div class="preview-img__error-message error-message" v-if="state === \'fail\'" @click.stop.prevent="">\n            <span class="error-message__notice">Upload fail</span>\n            <span class="error-message__message">{{ messages.error }}</span>\n        </div>\n    </slot>\n</div>\n    ',data:function(){return{state:a,progress:0,messages:{error:""}}},props:{item:Object,i:Number,initState:String,uploadUrl:String,size:Number},created:function(){this.state=this.initState,this.initState},mounted:function(){this.initState===t&&this.upload()},methods:{upload:function(){var e=this;this.state=i;var t=(new Date).valueOf(),s=new FormData;return s.append("file",this.item.file),this.item.title=this.item.file.name,this.$emit("upload-start",t),$.post({url:this.uploadUrl,data:s,contentType:!1,processData:!1,xhr:function(){var i=new XMLHttpRequest;return i.upload&&i.upload.addEventListener("progress",function(i){i.lengthComputable&&(e.progress=i.loaded/i.total,e.$emit("upload-progress",t,e.progress))},!1),i}}).done(function(t){e.state=a,e.item.url=t.data.url,e.isImage&&(e.item.thumb_url=t.data.thumb_url||t.data.url)}).fail(function(t){console.warn(t.responseJSON.message,t),e.state=n,e.messages.error=t.responseJSON.message}).always(function(){e.item.file=null,e.$emit("upload-end",t)})},deleteSelf:function(){this.$emit("delete",this.item)}},watch:{},computed:{fileName:function(){return this.item.file?this.item.file.name:this.item.title?this.item.title:this.item.url.split("/").pop()},isImage:function(){var e=this.item.file?this.item.file.name.split(".").pop():this.item.url.split(".").pop();return-1!==["png","jpeg","jpg","gif","bmp","webp"].indexOf(e)},icon:function(){return{pdf:"fas fa-file-pdf text-danger",xls:"fas fa-file-excel text-success",xlsx:"fas fa-file-excel text-success",doc:"fas fa-file-word text-primary",docx:"fas fa-file-word text-primary",ppt:"fas fa-file-powerpoint text-warning",pptx:"fas fa-file-powerpoint text-warning",zip:"fas fa-file-archive text-dark","7z":"fas fa-file-archive text-dark",rar:"fas fa-file-archive text-dark",mp4:"fas fa-file-video text-dark",avi:"fas fa-file-video text-dark",flv:"fas fa-file-video text-dark",mov:"fas fa-file-video text-dark",ogg:"fas fa-file-video text-dark",webm:"fas fa-file-video text-dark",mpg:"fas fa-file-video text-dark",mp3:"fas fa-file-audio text-dark",acc:"fas fa-file-audio text-dark",wav:"fas fa-file-audio text-dark"}[(this.item.file?this.item.file.name.split(".").pop():this.item.url.split(".").pop()).toLowerCase()]||"fas fa-file"}}}},template:'\n<div class="vue-drag-uploader">\n    <div class="vue-drag-uploader__wrapper">\n        <slot name="items" \n            :items="items"\n            :url="url"\n            :max-files="maxFiles"\n            :files-limited="maxFiles"\n        >\n            <draggable v-model="items" class="vue-drag-uploader__draggable-wrapper" \n                :options="{draggable: \'.preview-img\', animation: 300}">\n                <slot name="items" :item="items">\n                    <vue-drag-uploader-item\n                        v-for="(item, i) of items"\n                        :item="item"\n                        :i="i"\n                        :init-state="item.uploadState"\n                        :key="item.key"\n                        :upload-url="url"\n                        :size="thumbSize"\n                        @delete="deleteItem"\n                        @upload-start="uploadStart"\n                        @upload-end="uploadEnd"\n                        @upload-progress="uploadProgress"\n                        @click="itemClick"\n                        >\n                        <template slot="item">\n                            <slot name="item" \n                                :item="item"\n                                :i="i" \n                                :url="url"\n                                :max-files="maxFiles"\n                                :thumb-size="thumbSize"\n                                :files-limited="maxFiles"></slot>\n                        </template>\n                        <template slot="extra">\n                            <slot name="extra"\n                                :item="item" \n                                :i="i" \n                                :url="url"\n                                :max-files="maxFiles"\n                                :thumb-size="thumbSize"\n                                :files-limited="maxFiles">\n                            </slot>\n                        </template>\n                    </vue-drag-uploader-item>\n                </slot>\n                \n                <div v-if="canUpload" class="vue-drag-uploader__item add-button" :key="\'empty\'"\n                    @click="clickAdd()"\n                    :style="{ width: thumbSize ? thumbSize + \'px\' : null, height: thumbSize ? thumbSize + \'px\' : null }">\n                    <div class="add-button__body">\n                        <div class="add-button__icon">\n                            <span class="fa fa-upload fa-2x"></span>\n                        </div>\n                        <div class="add-button__text">\n                            {{ placeholder }}\n                        </div>\n                    </div>\n                </div>\n            </draggable>\n        </slot>\n    </div>\n</div>\n    ',data:function(){return{items:[],uploadQueue:{}}},props:{url:String,value:Array,maxFiles:[String,Number],thumbSize:Number,placeholder:String,accept:{type:String,default:""}},created:function(){var e=this;this.value.map(function(t){t.key=t.key||e.getKey(),t.uploadState=a}),this.items=this.value,null!=this.maxFiles&&this.maxFiles<this.items.length&&this.items.splice(this.maxFiles)},mounted:function(){var e=this;this.$el.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault(),e.currentTarget.classList.add("vue-drag-uploader--ondrag")}),this.$el.addEventListener("dragleave",function(e){e.stopPropagation(),e.preventDefault(),e.currentTarget.classList.remove("vue-drag-uploader--ondrag")}),this.$el.addEventListener("drop",function(t){t.stopPropagation(),t.preventDefault(),t.currentTarget.classList.remove("vue-drag-uploader--ondrag");var i=t.target.files||t.dataTransfer.files;e.uploadFiles(i)})},methods:{clickAdd:function(){var e=this,t=document.createElement("INPUT");t.setAttribute("type","file"),t.setAttribute("accept",this.accept),t.addEventListener("change",function(t){var i=t.target.files||t.dataTransfer.files;e.uploadFiles(i)}),t.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}))},getKey:function(){var e=new Date;return e.getTime()+"."+e.getMilliseconds()+"."+Math.random()},uploadFiles:function(e){var i=this;Array.prototype.forEach.call(e,function(e){if(i.checkFile(e),i.canUpload){var a=new FileReader,n={id:"",key:i.getKey(),url:"",thumb_url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",uploadState:t,file:e,title:"",alt:"",description:""};i.items.push(n),a.onload=function(e){var t=e.target.result;n.thumb_url=t},a.readAsDataURL(e)}})},checkFile:function(t){var i=this,a=this.acceptedTypes,n=t.name.split(".").pop();if(a.length){var s=!1;if(a.forEach(function(e){s||(-1!==e.indexOf("/")?i.compareMimeType(e,t.type)&&(s=!0):e===n&&(s=!0))}),!s)throw e(Phoenix.__("phoenix.form.field.drag.file.message.unaccepted.files"),Phoenix.__("phoenix.form.field.drag.file.message.unaccepted.files.desc",a.join(", ")),"warning"),new Error("Not accepted file ext")}},compareMimeType:function(e,t){var i=e.split("/"),a=t.split("/");return"*"===i[1]?i[0]===a[0]:e===t},deleteItem:function(e){this.$emit("delete-item",e),this.items=this.items.filter(function(t){return t.key!==e.key})},uploadStart:function(e){Vue.set(this.uploadQueue,e,0)},uploadEnd:function(e){Vue.delete(this.uploadQueue,e)},uploadProgress:function(e,t){this.uploadQueue[e]=t},itemClick:function(e,t,i){this.$emit("item-click",e,t,i)}},watch:{value:function(e){var t=this;e.map(function(e){e.key=e.key||t.getKey()}),this.items=e},items:{handler:function(e){this.$emit("change",e)},deep:!0},uploading:function(e){e?this.$emit("uploading"):this.$emit("uploaded")}},computed:{canUpload:function(){return null==this.maxFiles||this.items.length<this.maxFiles},uploading:function(){return Object.keys(this.uploadQueue),Object.keys(this.uploadQueue).length>0},acceptedTypes:function(){return(Array.isArray(this.accept)?this.accept:this.accept.split(",")).map(function(e){return e.trim()}).filter(function(e){return e.length>0}).map(function(e){return-1===e.indexOf("/")&&"."===e[0]?e.substr(1):e})}}};Vue.component("vue-drag-uploader",s)}();