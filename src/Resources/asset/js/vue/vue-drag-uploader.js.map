{"version":3,"sources":["vue/vue-drag-uploader.js"],"names":["itemStates","NEW","UPLOADING","COMPLETED","FAIL","STOP","VueDragUploaderItem","template","data","state","progress","messages","error","props","item","Object","initState","String","uploadUrl","created","mounted","upload","methods","uniqid","Date","valueOf","formData","FormData","append","file","$emit","$","post","url","contentType","processData","xhr","XMLHttpRequest","addEventListener","e","lengthComputable","loaded","total","done","res","fail","console","warn","responseJSON","message","always","deleteSelf","watch","VueDragUploader","components","items","uploadQueue","images","Array","maxFiles","Number","map","image","key","getKey","uploadState","length","splice","$el","event","stopPropagation","preventDefault","currentTarget","classList","add","remove","files","target","dataTransfer","uploadFiles","clickAdd","$input","document","createElement","setAttribute","dispatchEvent","MouseEvent","window","date","getTime","getMilliseconds","Math","random","prototype","forEach","call","checkFile","canUpload","reader","FileReader","id","thumbUrl","push","onload","result","readAsDataURL","types","indexOf","type","deleteItem","child","filter","uploadStart","Vue","set","uploadEnd","delete","uploadProgress","handler","deep","uploading","val","computed","keys","component"],"mappings":"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","file":"vue-drag-uploader.js","sourcesContent":["/**\r\n * Part of ke project.\r\n *\r\n * @copyright  Copyright (C) 2018 ${ORGANIZATION}.\r\n * @license    __LICENSE__\r\n */\r\n\r\n(() => {\r\n  const itemStates = {\r\n    NEW: 'new',\r\n    UPLOADING: 'uploading',\r\n    COMPLETED: 'completed',\r\n    FAIL: 'fail',\r\n    STOP: 'stop',\r\n  };\r\n\r\n  const VueDragUploaderItem = {\r\n    template: `\r\n<a class=\"vue-drag-uploader__item preview-img\" :href=\"item.url || '#'\" target=\"_blank\">\r\n    <slot name=\"item\" :item=\"item\">\r\n        <div class=\"preview-img__body\"\r\n            :style=\"{'background-image': 'url(' + (item.url || item.thumbUrl) + ')'}\"></div>\r\n        <div class=\"preview-img__overlay\">\r\n          <span class=\"preview-img__remove-icon fa fa-times\"\r\n              @click.stop.prevent=\"deleteSelf()\"></span>\r\n          <slot name=\"extra\" :item=\"item\"></slot>\r\n        </div>\r\n\r\n        <div class=\"preview-img__progress\" v-if=\"state === 'uploading'\">\r\n            <div class=\"preview-img__progress-bar\"\r\n                :style=\"{width: (progress * 100) + '%'}\"\r\n            ></div>\r\n        </div>\r\n        <div class=\"preview-img__error-message error-message\" v-if=\"state === 'fail'\" @click.stop.prevent=\"\">\r\n            <span class=\"error-message__notice\">上傳失敗</span>\r\n            <span class=\"error-message__message\">{{ messages.error }}</span>\r\n        </div>\r\n    </slot>\r\n</a>\r\n    `,\r\n    data() {\r\n      return {\r\n        state: itemStates.COMPLETED,\r\n        progress: 0,\r\n        messages: {\r\n          error: ''\r\n        }\r\n      }\r\n    },\r\n    props: {\r\n      item: Object,\r\n      initState: String,\r\n      uploadUrl: String\r\n    },\r\n    created() {\r\n      this.state = this.initState;\r\n\r\n      if (this.initState === itemStates.NEW) {\r\n\r\n      }\r\n    },\r\n    mounted() {\r\n      if (this.initState === itemStates.NEW) {\r\n        this.upload();\r\n      }\r\n    },\r\n    methods: {\r\n      upload() {\r\n        this.state = itemStates.UPLOADING;\r\n\r\n        const uniqid = new Date().valueOf();\r\n        const formData = new FormData();\r\n        formData.append('file', this.item.file);\r\n\r\n        this.$emit('upload-start', uniqid);\r\n\r\n        return $.post({\r\n            url: this.uploadUrl,\r\n            data: formData,\r\n            contentType: false,\r\n            processData: false,\r\n            xhr: () => {\r\n              const xhr = new XMLHttpRequest();\r\n\r\n              if(xhr.upload){\r\n                xhr.upload.addEventListener('progress', e => {\r\n                  if (e.lengthComputable) {\r\n                    this.progress = e.loaded / e.total;\r\n                    this.$emit('upload-progress', uniqid, this.progress);\r\n                  }\r\n                }, false);\r\n              }\r\n\r\n              return xhr;\r\n            },\r\n        })\r\n          .done(res => {\r\n            this.state = itemStates.COMPLETED;\r\n            this.item.url = res.data.url;\r\n          })\r\n          .fail(xhr => {\r\n            console.warn(xhr.responseJSON.message, xhr);\r\n            this.state = itemStates.FAIL;\r\n            this.messages.error = xhr.responseJSON.message;\r\n          })\r\n          .always(() => {\r\n            this.item.file = null;\r\n\r\n            this.$emit('upload-end', uniqid);\r\n          });\r\n      },\r\n\r\n      deleteSelf() {\r\n        this.$emit('delete', this.item);\r\n      }\r\n    },\r\n    watch: {\r\n    }\r\n  };\r\n\r\n  const VueDragUploader = {\r\n    components: {\r\n      'vue-drag-uploader-item': VueDragUploaderItem\r\n    },\r\n    template: `\r\n<div class=\"vue-drag-uploader\">\r\n    <div class=\"vue-drag-uploader__wrapper\">\r\n        <slot name=\"items\" \r\n            :items=\"items\"\r\n            :url=\"url\"\r\n            :max-files=\"maxFiles\"\r\n            :files-limited=\"maxFiles\"\r\n        >\r\n            <draggable v-model=\"items\" class=\"vue-drag-uploader__draggable-wrapper\" \r\n                :options=\"{draggable: '.preview-img'}\">\r\n                <slot name=\"items\" :item=\"items\">\r\n                    <vue-drag-uploader-item\r\n                        v-for=\"(item, i) of items\"\r\n                        :item=\"item\"\r\n                        :init-state=\"item.uploadState\"\r\n                        :key=\"item.key\"\r\n                        :upload-url=\"url\"\r\n                        @delete=\"deleteItem\"\r\n                        @upload-start=\"uploadStart\"\r\n                        @upload-end=\"uploadEnd\"\r\n                        @upload-progress=\"uploadProgress\"\r\n                        >\r\n                        <template slot=\"item\">\r\n                            <slot name=\"item\" \r\n                                :item=\"item\" \r\n                                :i=\"i\" \r\n                                :url=\"url\"\r\n                                :max-files=\"maxFiles\"\r\n                                :files-limited=\"maxFiles\"></slot>\r\n                        </template>\r\n                        <template slot=\"extra\">\r\n                            <slot name=\"extra\" \r\n                                :item=\"item\" \r\n                                :i=\"i\" \r\n                                :url=\"url\"\r\n                                :max-files=\"maxFiles\"\r\n                                :files-limited=\"maxFiles\"></slot>\r\n                        </template>\r\n                    </vue-drag-uploader-item>\r\n                </slot>\r\n                \r\n                <div v-if=\"canUpload\" class=\"vue-drag-uploader__item add-button\" :key=\"'empty'\"\r\n                    @click=\"clickAdd()\">\r\n                    <div class=\"add-button__body\">\r\n                        <div class=\"add-button__icon\">\r\n                            <span class=\"fa fa-upload fa-2x\"></span>\r\n                        </div>\r\n                        <div class=\"add-button__text\">\r\n                            拖拉圖片或按此上傳\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </draggable>\r\n        </slot>\r\n    </div>\r\n</div>\r\n    `,\r\n    data() {\r\n      return {\r\n        items: [],\r\n        uploadQueue: {}\r\n      }\r\n    },\r\n    props: {\r\n      url: String,\r\n      images: Array,\r\n      maxFiles: [String, Number]\r\n    },\r\n    created() {\r\n      this.images.map(image => {\r\n        image.key = image.key || this.getKey();\r\n        image.uploadState = itemStates.COMPLETED;\r\n      });\r\n\r\n      this.items = this.images;\r\n\r\n      if (this.maxFiles != null) {\r\n        if (this.maxFiles < this.items.length) {\r\n          this.items.splice(this.maxFiles);\r\n        }\r\n      }\r\n    },\r\n    mounted() {\r\n      this.$el.addEventListener('dragover', event => {\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n\r\n        event.currentTarget.classList.add('vue-drag-uploader--ondrag');\r\n      });\r\n\r\n      this.$el.addEventListener('dragleave', event => {\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n\r\n        event.currentTarget.classList.remove('vue-drag-uploader--ondrag');\r\n      });\r\n\r\n      // File drop\r\n      this.$el.addEventListener(\"drop\", event => {\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n\r\n        event.currentTarget.classList.remove('vue-drag-uploader--ondrag');\r\n\r\n        const files = event.target.files || event.dataTransfer.files;\r\n\r\n        this.uploadFiles(files);\r\n      });\r\n    },\r\n    methods: {\r\n      clickAdd() {\r\n        const $input = document.createElement(\"INPUT\");\r\n        $input.setAttribute('type', 'file');\r\n\r\n        $input.addEventListener('change', event => {\r\n          const files = event.target.files || event.dataTransfer.files;\r\n\r\n          this.uploadFiles(files);\r\n        });\r\n\r\n        $input.dispatchEvent(new MouseEvent('click', {\r\n          'view': window,\r\n          'bubbles': true,\r\n          'cancelable': true\r\n        }));\r\n      },\r\n\r\n      getKey() {\r\n        const date = new Date();\r\n\r\n        return date.getTime() + '.' + date.getMilliseconds() + '.' + Math.random();\r\n      },\r\n\r\n      uploadFiles(files) {\r\n        Array.prototype.forEach.call(files, file => {\r\n          if (!this.checkFile(file)) {\r\n            return;\r\n          }\r\n\r\n          if (!this.canUpload) {\r\n            return;\r\n          }\r\n\r\n          const reader = new FileReader;\r\n          const url = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=';\r\n          const item = {\r\n            id: '',\r\n            key: this.getKey(),\r\n            url: '',\r\n            thumbUrl: url,\r\n            uploadState: itemStates.NEW,\r\n            file: file\r\n          };\r\n\r\n          this.items.push(item);\r\n\r\n          reader.onload = (event) => {\r\n            const url = event.target.result;\r\n\r\n            item.thumbUrl = url;\r\n          };\r\n\r\n          reader.readAsDataURL(file);\r\n        });\r\n      },\r\n\r\n      checkFile: function(file) {\r\n        const types = [\r\n          'image/jpeg',\r\n          'image/png',\r\n          'image/gif'\r\n        ];\r\n\r\n        return types.indexOf(file.type) !== -1;\r\n      },\r\n\r\n      deleteItem(child) {\r\n        this.$emit('delete-item', child);\r\n\r\n        this.items = this.items.filter(item => item.key !== child.key);\r\n      },\r\n\r\n      uploadStart(uniqid) {\r\n        Vue.set(this.uploadQueue, uniqid, 0);\r\n      },\r\n\r\n      uploadEnd(uniqid) {\r\n        Vue.delete(this.uploadQueue, uniqid);\r\n      },\r\n\r\n      uploadProgress(uniqid, progress) {\r\n        this.uploadQueue[uniqid] = progress;\r\n      },\r\n    },\r\n    watch: {\r\n      images(images) {\r\n        images.map(image => {\r\n          image.key = image.key || this.getKey();\r\n        });\r\n\r\n        this.items = images;\r\n      },\r\n\r\n      items: {\r\n        handler(items) {\r\n          this.$emit('change', items);\r\n        },\r\n        deep: true\r\n      },\r\n\r\n      uploading(val) {\r\n        if (val) {\r\n          this.$emit('uploading');\r\n        } else {\r\n          this.$emit('uploaded');\r\n        }\r\n      }\r\n    },\r\n    computed: {\r\n      canUpload() {\r\n        return this.maxFiles == null || this.items.length < this.maxFiles;\r\n      },\r\n\r\n      uploading() {\r\n        Object.keys(this.uploadQueue);\r\n        return Object.keys(this.uploadQueue).length > 0;\r\n      }\r\n    }\r\n  };\r\n\r\n  Vue.component('vue-drag-uploader', VueDragUploader);\r\n})();\r\n"]}