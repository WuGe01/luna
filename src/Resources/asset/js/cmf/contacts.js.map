{"version":3,"sources":["cmf/contacts.js"],"names":["$","ContactPreview","fields","options","lang_prefix","handlers","init","modal","buttons","table","find","loading","editButton","bindEvents","hash","window","location","id","replace","showContact","self","on","event","preventDefault","data","Error","empty","hide","show","Phoenix","Ajax","get","Router","route","done","response","success","updateTable","item","console","log","message","then","fadeIn","fail","error","url","SimpleURI","setVar","attr","toString","each","key","undefined","addRow","details","Object","keys","length","text","Translator","translate","tr","append","k","e","value","cast","lang","html","callback","addFieldHandler","jQuery"],"mappings":"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","sourcesContent":["/**\n * Part of earth project.\n *\n * @copyright  Copyright (C) 2017 ${ORGANIZATION}.\n * @license    __LICENSE__\n */\n\n(($) => {\n  const ContactPreview = {\n    fields: [\n      'id',\n      'subject',\n      'name',\n      'email',\n      'phone',\n      'url',\n      'created',\n      'content'\n    ],\n\n    options: {\n      lang_prefix: 'luna.'\n    },\n\n    handlers: {},\n\n    init() {\n      this.modal = $('#preview-modal');\n      this.buttons = $('[data-preview-button]');\n      this.table = this.modal.find('#preview-table');\n      this.loading = this.modal.find('#preview-loading');\n      this.editButton = this.modal.find('#preview-edit-button');\n\n      this.bindEvents();\n\n      const hash = window.location.hash;\n\n      if (hash) {\n        const id = hash.replace(/\\#contact-/, '');\n\n        this.showContact(id);\n      }\n    },\n\n    bindEvents() {\n      const self = this;\n      this.buttons.on('click', function(event) {\n        event.preventDefault();\n\n        const id = $(this).data('preview-id');\n\n        self.showContact(id);\n      });\n\n      this.modal.on('hide.bs.modal', function() {\n        window.location.hash = '';\n      });\n    },\n\n    showContact(id) {\n      const self = this;\n\n      if (!id) {\n        throw new Error('No preview ID.')\n      }\n\n      self.table.empty().hide();\n      self.loading.show();\n\n      window.location.hash = 'contact-' + id;\n\n      Phoenix.Ajax.get(Phoenix.Router.route('contact_preview'), {'id': id})\n        .done(function(response) {\n          if (response.success) {\n            self.updateTable(response.data.item);\n          } else {\n            console.log(response.message);\n          }\n        }).then(function() {\n        self.loading.hide();\n        self.table.fadeIn();\n      }).fail(function(error) {\n        console.log(error);\n      });\n\n      self.modal.modal('show');\n\n      // Replace edit button URL\n      const url = new SimpleURI(Phoenix.Router.route('contact_edit'));\n      url.setVar('id', id);\n      this.editButton.attr('href', url.toString());\n    },\n\n    updateTable(item) {\n      const self = this;\n\n      this.table.empty();\n\n      $.each(this.fields, function() {\n        const key = this.toString();\n\n        if (item[key] !== undefined) {\n          self.addRow(key, item[key]);\n        }\n      });\n\n      if (item.details && Object.keys(item.details).length) {\n        const text = Phoenix.Translator.translate(this.options.lang_prefix + 'contact.field.details');\n        const tr = $('<tr class=\"details-separator active\"><th style=\"text-align: center\" class=\"lead\" colspan=\"5\">' + text + '</th></tr>');\n        this.table.append(tr);\n      }\n\n      $.each(item.details, function(k, e) {\n        self.addRow(k, e ? e.toString() : '');\n      });\n    },\n\n    addRow(key, value) {\n      const tr = $('<tr class=\"row-' + key + '\"></tr>');\n\n      value = this.cast(key, value);\n\n      const lang = this.options.lang_prefix + 'contact.field.' + key;\n\n      tr.append($('<th width=\"150px\"></th>').text(Phoenix.Translator.translate(lang)));\n      tr.append($('<td></td>').html(value));\n\n      this.table.append(tr);\n    },\n\n    cast(key, value) {\n      if (value !== '') {\n        if (this.handlers[key] !== undefined) {\n          var callback = this.handlers[key];\n          return callback(key, value);\n        }\n\n        switch (key) {\n          case 'url':\n            value = '<a target=\"_blank\" href=\"' + value + '\">' + value + '</a>';\n            break;\n\n          case 'email':\n            value = '<a target=\"_blank\" href=\"mailto:' + value + '\">' + value + '</a>';\n            break;\n\n          case 'content':\n            value = value.replace(/\\n/g, '<br />');\n            break;\n        }\n      }\n\n      return value;\n    },\n\n    addFieldHandler(key, callback) {\n      this.handlers[key] = callback;\n\n      return this;\n    }\n  };\n\n  $(function() {\n    ContactPreview.init();\n  });\n\n  window.ContactPreview = ContactPreview;\n})(jQuery);\n"],"file":"contacts.js"}