"use strict";!function(t){var e={fields:["id","subject","name","email","phone","url","created","content"],options:{lang_prefix:"luna."},handlers:{},init:function(){this.modal=t("#preview-modal"),this.buttons=t("[data-preview-button]"),this.table=this.modal.find("#preview-table"),this.loading=this.modal.find("#preview-loading"),this.editButton=this.modal.find("#preview-edit-button"),this.bindEvents();var e=window.location.hash;if(e){var a=e.replace(/\#contact-/,"");this.showContact(a)}},bindEvents:function(){var e=this;this.buttons.on("click",function(a){a.preventDefault();var i=t(this).data("preview-id");e.showContact(i)}),this.modal.on("hide.bs.modal",function(){window.location.hash=""})},showContact:function(t){var e=this;if(!t)throw new Error("No preview ID.");e.table.empty().hide(),e.loading.show(),window.location.hash="contact-"+t,Phoenix.Ajax.get(Phoenix.Router.route("contact_preview"),{id:t}).done(function(t){t.success?e.updateTable(t.data.item):console.log(t.message)}).then(function(){e.loading.hide(),e.table.fadeIn()}).fail(function(t){console.log(t)}),e.modal.modal("show");var a=new SimpleURI(Phoenix.Router.route("contact_edit"));a.setVar("id",t),this.editButton.attr("href",a.toString())},updateTable:function(e){var a=this;if(this.table.empty(),t.each(this.fields,function(){var t=this.toString();void 0!==e[t]&&a.addRow(t,e[t])}),e.details&&Object.keys(e.details).length){var i=Phoenix.Translator.translate(this.options.lang_prefix+"contact.field.details"),n=t('<tr class="details-separator active"><th style="text-align: center" class="lead" colspan="5">'+i+"</th></tr>");this.table.append(n)}t.each(e.details,function(t,e){a.addRow(t,e?e.toString():"")})},addRow:function(e,a){var i=t('<tr class="row-'+e+'"></tr>');a=this.cast(e,a);var n=this.options.lang_prefix+"contact.field."+e;i.append(t('<th width="150px"></th>').text(Phoenix.Translator.translate(n))),i.append(t("<td></td>").html(a)),this.table.append(i)},cast:function(t,e){if(""!==e){if(void 0!==this.handlers[t])return(0,this.handlers[t])(t,e);switch(t){case"url":e='<a target="_blank" href="'+e+'">'+e+"</a>";break;case"email":e='<a target="_blank" href="mailto:'+e+'">'+e+"</a>";break;case"content":e=e.replace(/\n/g,"<br />")}}return e},addFieldHandler:function(t,e){return this.handlers[t]=e,this}};t(function(){e.init()}),window.ContactPreview=e}(jQuery);